<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PINLE 3C - é›²ç«¯ç®¡ç†ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        /* Cyberbiz æ·ºç¶ è‰²èª¿èˆ‡å°ˆæ¥­æ„Ÿ */
        :root {
            --cb-green: #52b788; /* Cyberbiz æ‹›ç‰Œæ·ºç¶  */
            --cb-dark: #2d3436;
            --cb-bg: #f8f9fa;
        }

        body { font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif; background-color: var(--cb-bg); margin: 0; padding: 0; }
        
        /* é ‚éƒ¨å°èˆª */
        .header { background: white; padding: 15px 30px; border-bottom: 2px solid var(--cb-green); display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 22px; font-weight: bold; color: var(--cb-green); letter-spacing: 1px; }

        .container { max-width: 600px; margin: 30px auto; background: white; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); overflow: hidden; }
        
        .form-section { padding: 30px; }
        .label { font-size: 14px; font-weight: bold; color: #636e72; margin-bottom: 8px; display: block; }
        
        input, select {
            width: 100%; padding: 12px 15px; margin-bottom: 20px;
            border: 1px solid #dfe6e9; border-radius: 8px; font-size: 16px;
            transition: all 0.3s ease; box-sizing: border-box;
        }
        input:focus { border-color: var(--cb-green); outline: none; box-shadow: 0 0 0 3px rgba(82, 183, 136, 0.1); }

        /* æ¨¡ç³Šæœå°‹å»ºè­°æ¨™ç±¤ */
        #suggArea { display: none; margin-top: -15px; margin-bottom: 15px; padding: 10px; background: #f1fcf7; border-radius: 8px; }
        .name-tag { display: inline-block; background: white; color: var(--cb-green); border: 1px solid var(--cb-green); padding: 6px 12px; margin: 4px; border-radius: 20px; cursor: pointer; font-size: 14px; transition: 0.2s; }
        .name-tag:hover { background: var(--cb-green); color: white; }

        /* æ­·å²ç´€éŒ„èˆ‡åºè™Ÿ */
        #historyBox { display: none; margin-bottom: 25px; border-top: 1px dashed #ddd; padding-top: 20px; }
        .record-card { padding: 12px; background: #fff; border: 1px solid #f1f2f6; border-radius: 8px; margin-bottom: 10px; position: relative; }
        .sn-badge { display: block; font-size: 12px; color: #636e72; background: #f1f2f6; padding: 4px 8px; border-radius: 4px; margin-top: 8px; border-left: 3px solid var(--cb-green); }

        /* åŠŸèƒ½æŒ‰éˆ• */
        .btn-group { display: flex; gap: 15px; padding: 0 30px 30px; }
        .btn { flex: 1; padding: 15px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.3s; color: white; }
        .btn-stock { background-color: #34495e; } /* é€²è²¨ç”¨æ·±è‰² */
        .btn-pay { background-color: var(--cb-green); } /* çµå¸³ç”¨æ·ºç¶  */
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
    </style>
</head>
<body>

<div class="header">
    <div class="logo">PINLE 3C</div>
    <div style="color: #b2bec3; font-size: 14px;">2026 é›²ç«¯ POS ç³»çµ±</div>
</div>

<div class="container">
    <div class="form-section">
        <span class="label">å®¢æˆ¶å§“å (æ¨¡ç³Šæœå°‹)</span>
        <input type="text" id="custName" placeholder="è«‹è¼¸å…¥å§“åé—œéµå­—..." oninput="handleSearch()">
        
        <div id="suggArea"></div>

        <div id="historyBox">
            <div style="font-weight: bold; margin-bottom: 10px; color: var(--cb-dark);">ğŸ“‹ æ­·å²ç´€éŒ„èˆ‡åºè™Ÿè¿½è¹¤</div>
            <div id="hList"></div>
        </div>

        <span class="label">å•†å“é€²è²¨è©³æƒ…</span>
        <select id="prodType">
            <option value="é…ä»¶é€²è²¨">ğŸ“¦ é…ä»¶ / å…¶ä»–å•†å“é€²è²¨</option>
            <option value="æ‰‹æ©Ÿé€²è²¨">ğŸ“± æ‰‹æ©Ÿå•†å“é€²è²¨</option>
        </select>
        
        <input type="text" id="snNum" placeholder="è«‹æƒææˆ–è¼¸å…¥å•†å“åºè™Ÿ (IMEI/SN)">
        <input type="text" id="source" placeholder="è«‹è¼¸å…¥é€²è²¨äºº / ä¾›æ‡‰å•†åç¨±">
    </div>

    <div class="btn-group">
        <button class="btn btn-stock" onclick="alert('é€²è²¨å·²å…¥åº«')">ç¢ºèªé€²è²¨</button>
        <button class="btn btn-pay" onclick="alert('è¨‚å–®çµå¸³æˆåŠŸ')">ç¢ºèªçµå¸³</button>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://mypos2026-2625d-default-rtdb.asia-southeast1.firebasedatabase.app/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let memberData = {};

    db.ref('members').on('value', (s) => { memberData = s.val() || {}; });

    function handleSearch() {
        const val = document.getElementById('custName').value.trim();
        const suggArea = document.getElementById('suggArea');
        suggArea.innerHTML = '';

        if(!val) { suggArea.style.display = 'none'; return; }

        const matches = Object.keys(memberData).filter(n => n.includes(val));
        if(matches.length > 0) {
            suggArea.style.display = 'block';
            matches.forEach(name => {
                const tag = document.createElement('div');
                tag.className = 'name-tag';
                tag.innerText = name;
                tag.onclick = () => { selectMember(name); };
                suggArea.appendChild(tag);
            });
        }
        if(memberData[val]) selectMember(val);
    }

    function selectMember(name) {
        document.getElementById('custName').value = name;
        document.getElementById('suggArea').style.display = 'none';
        const box = document.getElementById('historyBox');
        const list = document.getElementById('hList');
        
        list.innerHTML = '';
        const history = memberData[name].history;
        Object.values(history).sort((a,b) => new Date(b.date) - new Date(a.date)).slice(0, 5).forEach(h => {
            list.innerHTML += `
                <div class="record-card">
                    <div style="font-size:12px; color:#b2bec3;">${h.date}</div>
                    <div style="font-weight:bold; color:var(--cb-dark);">${h.item} <span style="float:right; color:var(--cb-green);">$${h.price}</span></div>
                    ${h.sn ? `<span class="sn-badge">ğŸ” åºè™Ÿï¼š${h.sn} | ä¾†æºï¼š${h.supplier || 'æœªè¨»è¨˜'}</span>` : ''}
                </div>`;
        });
        box.style.display = 'block';
    }
</script>

</body>
</html>
