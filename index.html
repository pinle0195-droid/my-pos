window.executeCheckout = () => {
        const sn = document.getElementById('sale-scan').value.trim();
        const buyer = document.getElementById('sale-buyer').value.trim();
        const price = parseFloat(document.getElementById('sale-price').value);
        const method = document.getElementById('pay-method').value;
        const itemName = document.getElementById('res-item').innerText;

        if (!buyer || isNaN(price) || itemName.includes("âŒ")) return alert("è«‹ç¢ºèªå§“åã€å”®åƒ¹èˆ‡åºè™Ÿæ˜¯å¦æ­£ç¢º");

        const btn = document.getElementById('btn-pay-exec');
        btn.innerText = "åŒæ­¥ä¸­...";
        btn.disabled = true;

        const payload = {
            action: "checkout",
            date: new Date().toLocaleDateString('zh-TW'),
            payMethod: method,
            consumerName: buyer + " - " + itemName,
            price: price,
            cost: currentCost, 
            note: sn, // ğŸ‘ˆ ä¿®æ­£ï¼šå‚³é€ç´”åºè™Ÿï¼Œé€™æ¨£ Excel æ‰æœå¾—åˆ°ä¸¦å›å¡« F/H æ¬„
            staff: document.getElementById('staff-select').value
        };

        fetch(GOOGLE_SCRIPT_URL, { method: "POST", mode: "no-cors", body: JSON.stringify(payload) })
        .then(() => {
            // ğŸ’¡ å‚™è¨»ï¼šä¸å†åŸ·è¡Œ Firebase ç§»é™¤ï¼Œä¿ç•™åº«å­˜ä»¥ä¾¿åœ¨åº«å­˜è¡¨çœ‹åˆ°éŠ·è²¨è³‡è¨Š
            alert("âœ… çµå¸³æˆåŠŸï¼\n1. æµæ°´å¸³å·²æ–°å¢\n2. åº«å­˜è¡¨å·²å›å¡«éŠ·è²¨è³‡è¨Š");
            location.reload();
        })
        .catch(err => {
            alert("åŒæ­¥å¤±æ•—ï¼š" + err.message);
            btn.disabled = false;
        });
    };
