<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PINLE 3C | POS ç³»çµ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --pinle-green: #52b788; --pinle-dark: #2d3436; }
        body { font-family: sans-serif; background: #f8f9fa; margin: 0; padding: 10px; }
        .card { max-width: 500px; margin: auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border-top: 6px solid var(--pinle-green); }
        .logo { font-size: 22px; font-weight: bold; color: var(--pinle-green); text-align: center; display: block; margin-bottom: 15px; }
        
        .tabs { display: flex; gap: 5px; margin-bottom: 20px; }
        .tab { flex: 1; padding: 12px 5px; text-align: center; background: #eee; border-radius: 8px; cursor: pointer; font-weight: bold; color: #666; font-size: 14px; }
        .tab.active { background: var(--pinle-green); color: white; }

        label { font-size: 13px; font-weight: bold; color: #636e72; display: block; margin-bottom: 5px; }
        input, select { width: 100%; padding: 12px; border: 1px solid #dfe6e9; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 15px; }
        
        /* åº«å­˜ç‹€æ…‹é¡¯ç¤ºå€ */
        .status-box { background: #f1fcf7; padding: 15px; border-radius: 8px; margin-bottom: 15px; border: 1px solid #d1e7dd; }
        .cost-tag { color: #e74c3c; font-weight: bold; font-size: 18px; }
        .item-tag { color: var(--pinle-dark); font-weight: bold; font-size: 18px; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 13px; }
        th, td { border: 1px solid #eee; padding: 10px; text-align: center; }
        th { background: #f8f9fa; }

        .btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 18px; font-weight: bold; cursor: pointer; color: white; margin-top: 10px; }
        .btn-pay { background: var(--pinle-green); }
        .btn-stock { background: var(--pinle-dark); }
        
        .section { display: none; }
        .section.active { display: block; }
    </style>
</head>
<body>

<div class="card">
    <span class="logo">PINLE 3C POS</span>

    <div class="tabs">
        <div class="tab active" id="tab-sale" onclick="switchTab('sale')">ğŸ›’ éŠ·å”®çµå¸³</div>
        <div class="tab" id="tab-stock" onclick="switchTab('stock')">ğŸ“¦ å•†å“é€²è²¨</div>
        <div class="tab" id="tab-search" onclick="switchTab('search')">ğŸ” å®¢æˆ¶æŸ¥è©¢</div>
    </div>

    <div id="sec-sale" class="section active">
        <label>1. æƒææ¢ç¢¼ (IMEI/SN)</label>
        <input type="text" id="sale-scan" placeholder="è«‹æƒæåºè™Ÿæ¢ç¢¼" oninput="autoFetchInventory()">
        
        <div class="status-box">
            <div>å“åï¼š<span id="res-item" class="item-tag">ç­‰å¾…æƒæ...</span></div>
            <div style="margin-top:5px;">æˆæœ¬ï¼š<span id="res-cost" class="cost-tag">---</span></div>
        </div>

        <label>2. è³¼è²·äººå§“å/é›»è©±</label>
        <input type="text" id="sale-buyer" placeholder="è«‹è¼¸å…¥å§“åæˆ–é›»è©±">
        
        <label>3. æˆäº¤å”®åƒ¹</label>
        <input type="number" id="sale-price" placeholder="è¼¸å…¥æˆäº¤é‡‘é¡">
        
        <button class="btn btn-pay" onclick="handlePay()">ç¢ºèªçµå¸³ä¸¦æ‰£é™¤åº«å­˜</button>
    </div>

    <div id="sec-stock" class="section">
        <label>é€²è²¨å“å</label>
        <input type="text" id="stk-name" placeholder="ä¾‹å¦‚ï¼šiPhone 15 Pro">
        <label>å•†å“æ¢ç¢¼ (IMEI/SN)</label>
        <input type="text" id="stk-sn" placeholder="è«‹æƒæåºè™Ÿ">
        <label>é€²è²¨æˆæœ¬</label>
        <input type="number" id="stk-cost" placeholder="è«‹è¼¸å…¥æˆæœ¬">
        <label>ä¾›æ‡‰å•†/é€²è²¨äºº</label>
        <input type="text" id="stk-source" placeholder="è«‹è¼¸å…¥ä¾†æº">
        <button class="btn btn-stock" onclick="handleIn()">ç¢ºèªé€²è²¨å…¥åº«</button>
    </div>

    <div id="sec-search" class="section">
        <label>è¼¸å…¥å®¢æˆ¶é›»è©±æˆ–å§“å</label>
        <input type="text" id="find-key" placeholder="è¼¸å…¥æœå°‹é—œéµå­—">
        <button class="btn btn-pay" onclick="doQuery()">å³æ™‚æŸ¥è©¢ç´€éŒ„</button>

        <div id="query-res" style="display:none; margin-top:20px;">
            <h4 id="q-name">---</h4>
            <table>
                <thead><tr><th>æ—¥æœŸ</th><th>å“é …èˆ‡åºè™Ÿ</th><th>é‡‘é¡</th></tr></thead>
                <tbody id="q-table"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        databaseURL: "https://mypos2026-2625d-default-rtdb.asia-southeast1.firebasedatabase.app/"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // åˆ†é åˆ‡æ›
    window.switchTab = function(type) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.getElementById('tab-' + type).classList.add('active');
        document.getElementById('sec-' + type).classList.add('active');
    };

    // æ ¸å¿ƒåŠŸèƒ½ï¼šæƒææ¢ç¢¼è‡ªå‹•å¸¶å‡ºè³‡æ–™
    window.autoFetchInventory = function() {
        const sn = document.getElementById('sale-scan').value.trim();
        const resItem = document.getElementById('res-item');
        const resCost = document.getElementById('res-cost');

        if(sn.length < 2) {
            resItem.innerText = "ç­‰å¾…æƒæ...";
            resCost.innerText = "---";
            return;
        }

        // å»è³‡æ–™åº«çš„ inventory ç¯€é»ç›´æ¥æ‰¾é€™å€‹ SN
        db.ref('inventory/' + sn).once('value').then((snapshot) => {
            if (snapshot.exists()) {
                const data = snapshot.val();
                resItem.innerText = data.name;
                resCost.innerText = "$" + data.cost;
                resItem.style.color = "#52b788"; // æ‰¾åˆ°è®Šæˆç¶ è‰²
            } else {
                resItem.innerText = "åº«å­˜ç„¡æ­¤å•†å“";
                resCost.innerText = "---";
                resItem.style.color = "#e74c3c"; // æ²’æ‰¾åˆ°è®Šç´…è‰²
            }
        });
    };

    // çµå¸³ä¸¦æ‰£åº«å­˜
    window.handlePay = function() {
        const sn = document.getElementById('sale-scan').value.trim();
        const buyer = document.getElementById('sale-buyer').value.trim();
        const price = document.getElementById('sale-price').value.trim();
        const itemName = document.getElementById('res-item').innerText;

        if(!buyer || !price || itemName === "ç­‰å¾…æƒæ..." || itemName === "åº«å­˜ç„¡æ­¤å•†å“") {
            alert("è«‹ç¢ºä¿å·²æƒææœ‰æ•ˆæ¢ç¢¼ï¼Œä¸¦å¡«å¯«è³¼è²·äººèˆ‡é‡‘é¡");
            return;
